<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›¡ï¸ CodeGuard AI - Ù…Ù†ØµØ© Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<!-- PWA Manifest -->
<link rel="manifest" href="data:application/manifest+json,{
  \"name\":\"ğŸ›¡ï¸ CodeGuard AI\",\"short_name\":\"CodeGuard\",
  \"theme_color\":\"#2563eb\",\"background_color\":\"#020617\",
  \"display\":\"standalone\",\"start_url\":\"/\",
  \"icons\":[{\"src\":\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMyNTYzRUIiLz4KPHRleHQgeD0iOTYiIHk9IjExNSIgZm9udC1mYW1pbHk9IkNhaXJvLCBBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iI0ZGRiIgZm9udC13ZWlnaHQ9IjgwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+44CR44CRPCsvyDYs9ixPCsvyE8L3RleHQ+Cjwvc3ZnPiI\",\"sizes\":\"192x192\"}]
}">
<meta name="theme-color" content="#2563eb">
<style>
:root{
  --bg:#020617;--card:rgba(15,23,42,.97);--blue:#38bdf8;--blue2:#2563eb;--green:#22c55e;--red:#ef4444;--yellow:#eab308;--purple:#8b5cf6;
  --light-bg:#f8fafc;--light-card:rgba(255,255,255,.98);--light-text:#1e293b;--glass:rgba(255,255,255,0.12);
}
*{box-sizing:border-box;font-family:'Cairo',sans-serif;margin:0;padding:0;}
body{background:linear-gradient(135deg,var(--bg),#111827);color:#e5e7eb;overflow-x:hidden;transition:all .4s;}
.hidden{display:none;transition:all .4s ease;}
body.light{background:var(--light-bg);color:var(--light-text);}
body.light .card{background:var(--light-card);color:var(--light-text);}
body.light nav{background:var(--light-card);color:var(--light-text);}

.loading{display:inline-block;width:22px;height:22px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;margin-right:12px;animation:spin 1s ease-in-out infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

#login{height:100vh;background:linear-gradient(135deg,#020617,rgba(56,189,248,0.2));display:flex;justify-content:center;align-items:center;position:relative;}
#login::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(12px);background:rgba(0,0,0,0.5);z-index:1;}
.login-box{background:var(--card);backdrop-filter:blur(30px);padding:45px;width:90%;max-width:480px;border-radius:30px;box-shadow:0 35px 70px rgba(0,0,0,0.7);border:1px solid var(--glass);z-index:2;animation:fadeInUp 1.2s;}
.login-box h2{text-align:center;font-weight:800;margin-bottom:40px;background:linear-gradient(135deg,var(--blue),var(--blue2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:2.8em;}
.login-box input{width:100%;padding:20px;margin:18px 0;border:none;border-radius:18px;font-size:17px;background:var(--glass);color:#e5e7eb;border:1px solid rgba(255,255,255,0.3);transition:all .3s;}
.login-box input::placeholder{color:#9ca3af;}
.login-box input:focus{outline:none;box-shadow:0 0 0 4px rgba(56,189,248,0.4);border-color:var(--blue);transform:scale(1.02);}
button{background:linear-gradient(135deg,var(--blue2),var(--blue));color:#fff;font-weight:700;cursor:pointer;transition:all .3s;border:none;border-radius:18px;padding:20px;font-size:18px;box-shadow:0 10px 30px rgba(37,99,235,0.5);}
button:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 15px 40px rgba(37,99,235,0.7);}
button:disabled{background:#64748b;transform:none;cursor:not-allowed;}
@keyframes fadeInUp{from{opacity:0;transform:translateY(60px);}to{opacity:1;transform:translateY(0);}}

.success-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);backdrop-filter:blur(20px);display:flex;justify-content:center;align-items:center;z-index:10000;}
.success-box{background:linear-gradient(135deg,var(--green),#16a34a);color:#fff;padding:60px;border-radius:35px;text-align:center;max-width:500px;width:90%;box-shadow:0 40px 80px rgba(34,197,94,0.4);border:3px solid #fff;animation:pulse 2s infinite;}
.success-box h2{font-size:3em;margin-bottom:20px;}
.success-box p{font-size:1.4em;margin-bottom:30px;}
@keyframes pulse{0%,100%{transform:scale(1);box-shadow:0 40px 80px rgba(34,197,94,0.4);}50%{transform:scale(1.05);box-shadow:0 50px 100px rgba(34,197,94,0.6);}}

nav{position:sticky;top:0;z-index:100;background:var(--card);backdrop-filter:blur(30px);display:flex;justify-content:space-between;align-items:center;padding:18px 30px;border-bottom:1px solid rgba(255,255,255,0.2);box-shadow:0 15px 50px rgba(0,0,0,0.5);}
.logo{font-size:2.2em;font-weight:800;background:linear-gradient(135deg,var(--blue),#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.nav-buttons{display:flex;gap:15px;flex-wrap:wrap;align-items:center;}
nav button{background:rgba(30,41,59,0.95);color:#e5e7eb;border:none;padding:16px 28px;border-radius:18px;font-weight:700;cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
nav button:hover{background:linear-gradient(135deg,var(--blue2),var(--blue));transform:translateY(-2px);}
nav button.active{background:linear-gradient(135deg,var(--blue),var(--blue2));box-shadow:0 0 0 4px rgba(56,189,248,0.4);}
#modeToggle{padding:14px 20px;background:var(--blue2);border-radius:15px;font-size:22px;transition:all .3s;}
#modeToggle:hover{transform:scale(1.15) rotate(180deg);}

.container{max-width:1300px;margin:auto;padding:30px;}
.grid{display:grid;gap:30px;}
.grid-4{grid-template-columns:repeat(auto-fit,minmax(300px,1fr));}
.card{background:var(--card);backdrop-filter:blur(25px);padding:35px;border-radius:25px;box-shadow:0 25px 55px rgba(0,0,0,0.5);border:1px solid var(--glass);transition:all .4s;}
.card:hover{transform:translateY(-12px) scale(1.02);box-shadow:0 35px 70px rgba(0,0,0,0.6);}

.stat{font-size:3em;font-weight:800;margin-bottom:15px;}
.stat.Low{color:var(--green);text-shadow:0 0 25px rgba(34,197,94,0.7);}
.stat.Medium{color:var(--yellow);text-shadow:0 0 25px rgba(234,179,8,0.7);}
.stat.High{color:var(--red);text-shadow:0 0 25px rgba(239,68,68,0.7);}
.stat.default{background:linear-gradient(135deg,var(--blue),#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.badge{display:inline-block;padding:12px 24px;border-radius:35px;background:linear-gradient(135deg,var(--blue2),var(--blue));font-weight:700;color:#fff;box-shadow:0 8px 25px rgba(37,99,235,0.5);}

.file-upload-btn{background:linear-gradient(135deg,var(--green),#16a34a);color:#fff;padding:18px 35px;border:none;border-radius:18px;cursor:pointer;font-weight:700;margin-bottom:25px;transition:all .3s;box-shadow:0 10px 30px rgba(34,197,94,0.5);}
.file-upload-btn:hover{transform:scale(1.05);}
textarea{width:100%;height:220px;background:rgba(17,24,39,0.97);color:#e5e7eb;border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:25px;font-family:'Courier New',monospace;font-size:16px;resize:vertical;}
textarea:focus{outline:none;box-shadow:0 0 0 4px rgba(56,189,248,0.4);border-color:var(--blue);}
#scanResult{margin-top:30px;padding:30px;border-radius:20px;background:rgba(0,0,0,0.6);border-left:6px solid var(--blue);}
.vuln-item{padding:25px;margin:15px 0;border-radius:18px;}
.severity-high{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;}
.severity-medium{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;}
.severity-low{background:linear-gradient(135deg,#10b981,#059669);color:#fff;}

.progress{background:rgba(30,41,59,0.97);border-radius:18px;height:24px;overflow:hidden;margin:30px 0;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--green),#86efac);border-radius:18px;transition:width 2s ease;box-shadow:0 0 30px rgba(34,197,94,0.7);}

.profile-img{border-radius:50%;width:120px;height:120px;margin:0 auto 30px;display:block;border:6px solid var(--glass);cursor:pointer;transition:all .4s;box-shadow:0 15px 40px rgba(0,0,0,0.5);}
.profile-img:hover{transform:scale(1.1);}
.logout-btn{background:linear-gradient(135deg,var(--red),#dc2626);color:#fff;padding:18px 45px;border:none;border-radius:18px;font-weight:700;cursor:pointer;transition:all .3s;margin-top:35px;}
.logout-btn:hover{transform:translateY(-3px);}

.thank-you-msg{background:linear-gradient(135deg,var(--green),#16a34a);color:#fff;padding:35px;border-radius:30px;margin:30px 0;text-align:center;font-weight:800;box-shadow:0 20px 50px rgba(34,197,94,0.5);border-left:10px solid #fff;}
.form-submitted form{display:none !important;}

.quiz-q{margin-bottom:30px;}
.quiz-q label{display:block;margin:15px 0;padding:22px;border-radius:18px;background:var(--glass);border:1px solid rgba(255,255,255,0.2);cursor:pointer;transition:all .3s;}
.quiz-q label:hover{background:rgba(56,189,248,0.25);transform:translateX(5px);}

.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);backdrop-filter:blur(20px);justify-content:center;align-items:center;z-index:1000;}
.modal video{width:95%;max-width:1100px;border-radius:25px;}

section{animation:fadeInUp 1.2s ease;}
@media(max-width:768px){
  .nav-buttons{flex-direction:column;gap:12px;}
  .container{padding:20px;}
  .grid-4{grid-template-columns:1fr;}
  nav{padding:15px 20px;flex-direction:column;gap:20px;}
}
@media(max-width:480px){
  .login-box{padding:35px;max-width:95%;}
  .card{padding:28px;}
}
</style>
</head>
<body>

<!-- LOGIN -->
<section id="login">
<div class="login-box">
<h2>ğŸ›¡ï¸ CodeGuard AI</h2>
<form id="loginForm">
<input name="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
<input name="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
<input type="hidden" name="form_type" value="login">
<button type="submit" id="loginBtn">
<span id="loginText">ğŸš€ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ©</span>
<span id="loginLoading" class="loading" style="display:none;"></span>
</button>
</form>
<div class="thank-you-msg hidden" id="loginThankYou">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ù†ØµØ©...</div>
</div>
</section>

<!-- SUCCESS OVERLAY (Ø´ÙƒØ± Ù…Ø¯Ù…Ø¬) -->
<div id="successOverlay" class="success-overlay hidden">
<div class="success-box">
<h2>ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!</h2>
<p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰<br><strong>shryfmhmdbdalghnyrajh@gmail.com</strong></p>
<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©...</p>
</div>
</div>

<!-- APP -->
<section id="app" class="hidden">
<nav>
<div class="logo">ğŸ›¡ï¸ CodeGuard AI</div>
<div class="nav-buttons">
<button onclick="showSection('dashboard',this)" class="active">ğŸ  Dashboard</button>
<button onclick="showSection('scanner',this)">ğŸ§° Scanner</button>
<button onclick="showSection('quiz',this)">ğŸ“ Exam</button>
<button onclick="showSection('courses',this)">ğŸ“ Courses</button>
<button onclick="showSection('profile',this)">ğŸ‘¤ Profile</button>
<button id="modeToggle" onclick="toggleMode()">ğŸŒ“</button>
<button onclick="window.open('https://wa.me/201098995624','_blank')" style="background:linear-gradient(135deg,var(--green),#16a34a);">ğŸ’¬</button>
</div>
</nav>

<div class="container">
<!-- DASHBOARD -->
<section id="dashboard">
<div class="grid grid-4">
<div class="card"><div class="stat default" id="secLevel">Medium</div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù…Ø§Ù†</div>
<div class="card"><div class="stat default" id="vulnCount">0</div>Ø§Ù„Ø«ØºØ±Ø§Øª</div>
<div class="card"><div class="stat default">ğŸ¤– AI</div>Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
<div class="card"><div class="stat default" id="userLevel">Ù…Ø¨ØªØ¯Ø¦</div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
</div>

<div class="grid grid-4">
<div class="card"><h4>ğŸ¤– ØªÙˆØµÙŠØ§Øª AI</h4><ul style="line-height:2;"><li>âœ… ØªØ¬Ù†Ø¨ eval() Ùˆ document.write</li><li>âœ… Prepared Statements Ù„Ù€ SQL</li><li>âœ… HTTPS + HSTS Headers</li><li>âœ… CSP Headers</li><li>âœ… Rate Limiting</li></ul></div>
<div class="card"><h4>ğŸ“Š ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h4><p id="quizScore">Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±</p><div class="progress"><div id="quizBar" class="progress-fill" style="width:0%"></div></div><span class="badge" id="badge">Ù„Ø§ Ø´Ø§Ø±Ø§Øª</span></div>
<div class="card"><h4>ğŸ“ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ¹Ù„Ù…</h4><ol><li>Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</li><li>Ø«ØºØ±Ø§Øª Ø§Ù„ÙˆÙŠØ¨</li><li>Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¢Ù…Ù†Ø©</li><li>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚</li><li>Ø£Ø¯ÙˆØ§Øª AI Ø§Ù„Ø£Ù…Ù†ÙŠØ©</li></ol></div>
<div class="card"><h4>ğŸ… Ø§Ù„Ø´Ø§Ø±Ø§Øª</h4><span class="badge" id="profileBadge">Ù„Ø§ Ø´Ø§Ø±Ø§Øª</span></div>
</div>
</section>

<!-- SCANNER -->
<section id="scanner" class="hidden">
<div class="card">
<h3>ğŸ§° ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠ AI</h3>
<input type="file" id="fileInput" accept=".txt,.js,.html,.php,.py,.css" style="display:none;">
<label for="fileInput" class="file-upload-btn">ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù ÙƒÙˆØ¯</label>
<textarea id="codeInput" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù... ÙŠØ¯Ø¹Ù… JS, HTML, PHP, Python, CSS"></textarea>
<button onclick="scanCode()" style="width:auto;padding:20px 50px;margin-top:25px;background:linear-gradient(135deg,var(--blue2),var(--blue));">ğŸš€ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
<button id="aiExplainBtn" onclick="toggleAIExplain()" style="background:linear-gradient(135deg,var(--purple),#7c3aed);">ğŸ§  ØªÙØ³ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
<div id="scanResult"></div>
<div id="aiExplain" class="ai-explain" style="display:none;"></div>
<div id="scanHistory"></div>
</div>
</section>

<!-- QUIZ -->
<section id="quiz" class="hidden">
<div class="card">
<h3>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ (15 Ø³Ø¤Ø§Ù„)</h3>
<form id="quizForm">
<div id="quizBox"></div>
<input type="hidden" name="result_score" id="resultScore">
<input type="hidden" name="form_type" value="quiz">
<button type="submit" id="quizSubmitBtn" style="width:auto;padding:20px 50px;margin-top:35px;">
<span id="quizBtnText">ğŸ“Š Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span>
<span id="quizLoading" class="loading" style="display:none;"></span>
</button>
</form>
<div class="thank-you-msg hidden" id="quizThankYou">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!<br>ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</div>
<div id="quizResult" style="margin-top:40px;display:none;"></div>
</div>
</section>

<!-- COURSES -->
<section id="courses" class="hidden">
<div class="grid grid-4">
<div class="card"><h4>ğŸ“ Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ù…Ù†</h4><p>Ù…Ù‚Ø¯Ù…Ø© Ø´Ø§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</p><button onclick="playCourseVideo('course1.mp4')" style="width:100%;padding:18px 30px;margin-top:25px;">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ 1</button></div>
<div class="card"><h4>ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«ØºØ±Ø§Øª</h4><p>ÙƒÙŠÙÙŠØ© Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©</p><button onclick="playCourseVideo('course2.mp4')" style="width:100%;padding:18px 30px;margin-top:25px;">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ 2</button></div>
</div>
</section>

<!-- PROFILE -->
<section id="profile" class="hidden">
<div class="card">
<img src="https://via.placeholder.com/120/2563eb/ffffff?text=ğŸ‘¤" alt="Profile" class="profile-img" id="profilePic">
<label for="profileUpload" class="file-upload-btn" style="display:block;margin:30px auto;width:fit-content;">ğŸ“¸ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</label>
<input type="file" id="profileUpload" accept="image/*">
<h3 style="text-align:center;margin:35px 0 25px 0;">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
<p id="pname" style="font-size:1.6em;text-align:center;font-weight:800;margin:25px 0;"></p>
<p id="pemail" style="font-size:1.4em;text-align:center;color:#9ca3af;margin:20px 0;"></p>
<p id="pLevel" style="font-size:1.5em;text-align:center;margin:30px 0;"></p>
<span class="badge" id="profileBadge" style="display:block;margin:25px auto;">Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ØªØ¯Ø¦</span>
<button onclick="logout()" class="logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</div>
</section>
</div>
</section>

<!-- Video Modal -->
<div class="modal" id="videoModal">
<button onclick="closeVideoModal(event)" style="position:absolute;top:30px;right:30px;z-index:1001;font-size:40px;background:none;border:none;color:#fff;cursor:pointer;">Ã—</button>
<video id="modalVideo" controls></video>
</div>

<script>
let user={},lastScore=0,scanHistoryArr=[],scanResults=[],currentVulns=[];

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
const EMAIL_TO = 'shryfmhmdbdalghnyrajh@gmail.com';
const questions = [
  ["XSS Ù‡ÙˆØŸ",["Ù‡Ø¬ÙˆÙ… Ù…ØªØµÙØ­","Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„","ØªØ´ÙÙŠØ±","Ø´Ø¨ÙƒØ©"],0],
  ["SQL InjectionØŸ",["Ø­Ù‚Ù†","ØªØ­Ø¯ÙŠØ«","Ù†Ø³Ø®","Ø­Ù…Ø§ÙŠØ©"],0],
  ["HTTPS Ø¢Ù…Ù†ØŸ",["Ù†Ø¹Ù…","Ù„Ø§"],0,true],
  ["Firewall ÙŠØ­Ù…ÙŠØŸ",["Ù†Ø¹Ù…","Ù„Ø§"],0,true],
  ["eval() Ø®Ø·Ø±ØŸ",["Ù†Ø¹Ù…","Ù„Ø§"],0,true],
  ["CSRF ProtectionØŸ",["Ù†Ø¹Ù… Ù…Ø·Ù„ÙˆØ¨","ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨"],0,true],
  ["2FA Ø£ÙØ¶Ù„ØŸ",["Ù†Ø¹Ù…","Ù„Ø§"],0,true],
  ["OWASP Top 10ØŸ",["Ø£Ù‡Ù…","ØºÙŠØ± Ù…Ù‡Ù…"],0,true],
  ["HTTPS CertificateØŸ",["SSL/TLS","Ø¹Ø§Ø¯ÙŠ"],0,true],
  ["Input ValidationØŸ",["Ù…Ø·Ù„ÙˆØ¨ Ø¯Ø§Ø¦Ù…Ø§Ù‹","Ø§Ø®ØªÙŠØ§Ø±ÙŠ"],0,true],
  ["JWT ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠØŸ",["Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©","Ø§Ù„ØªØ´ÙÙŠØ±","Ø§Ù„Ø¶ØºØ·","Ø§Ù„ØªØ®Ø²ÙŠÙ†"],0],
  ["CORS ÙŠØªØ­ÙƒÙ… ÙÙŠØŸ",["Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠÙ†ÙŠØ©","Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„","Ø§Ù„Ø°Ø§ÙƒØ±Ø©","Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬"],0],
  ["HSTS Header ÙŠØ¬Ø¨Ø±ØŸ",["HTTPS ÙÙ‚Ø·","HTTP","Mixed Content","Caching"],0],
  ["X-Frame-Options ÙŠØ­Ù…ÙŠ Ù…Ù†ØŸ",["Clickjacking","SQL Injection","XSS","CSRF"],0],
  ["Prepared Statements ØªØ­Ù…ÙŠ Ù…Ù†ØŸ",["SQL Injection","XSS","CSRF","DDoS"],0]
];

// Auto-login
window.addEventListener('load', () => {
  const name = localStorage.getItem('userName');
  const email = localStorage.getItem('userEmail');
  const theme = localStorage.getItem('theme');
  if (theme === 'light') document.body.classList.add('light');
  if (name && email) {
    user.name = name; user.email = email;
    document.getElementById('login').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    updateProfile(); 
  }
  generateQuiz();
});

function showSection(id, btn) {
  document.querySelectorAll('#app section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.nav-buttons button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function updateProfile() {
  document.getElementById('pname').textContent = `Ø§Ù„Ø§Ø³Ù…: ${user.name}`;
  document.getElementById('pemail').textContent = `Ø§Ù„Ø¨Ø±ÙŠØ¯: ${user.email}`;
  document.getElementById('pLevel').textContent = 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù…Ø¨ØªØ¯Ø¦';
  document.getElementById('profileBadge').textContent = 'Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ØªØ¯Ø¦';
}

// LOGIN FORM - Ø´ÙƒØ± Ù…Ø¯Ù…Ø¬ 100%
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const btn = document.getElementById('loginBtn');
  const text = document.getElementById('loginText');
  const loading = document.getElementById('loginLoading');
  const formData = new FormData(e.target);
  
  user.name = formData.get('name');
  user.email = formData.get('email');
  
  if (!user.name || !user.email) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
    return;
  }
  
  // Show loading
  btn.disabled = true;
  text.style.display = 'none';
  loading.style.display = 'inline-block';
  
  // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¹Ø¨Ø± formsubmit.co ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  const submitData = new FormData();
  submitData.append('name', user.name);
  submitData.append('email', user.email);
  submitData.append('form_type', 'login');
  submitData.append('_subject', 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¬Ø¯ÙŠØ¯ - CodeGuard AI');
  submitData.append('_captcha', 'false');
  
  fetch('https://formsubmit.co/shryfmhmdbdalghnyrajh@gmail.com', {
    method: 'POST',
    body: submitData
  }).catch(() => {}); // Ù„Ø§ ÙŠÙˆÙ‚Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„
  
  // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
  localStorage.setItem('userName', user.name);
  localStorage.setItem('userEmail', user.email);
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´ÙƒØ± Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©
  const container = e.target.closest('.login-box');
  const thankYou = document.getElementById('loginThankYou');
  container.classList.add('form-submitted');
  thankYou.classList.remove('hidden');
  
  // Reset button
  setTimeout(() => {
    btn.disabled = false;
    text.style.display = 'inline-block';
    loading.style.display = 'none';
  }, 1000);
  
  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ù†ØµØ©
  setTimeout(() => {
    document.getElementById('login').classList.add('hidden');
    document.getElementById('successOverlay').classList.remove('hidden');
    setTimeout(() => {
      document.getElementById('successOverlay').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      updateProfile();
    }, 3000);
  }, 2000);
});

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„...
document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = evt => document.getElementById('codeInput').value = evt.target.result;
    reader.readAsText(file);
  }
});

function scanCode() {
  const code = document.getElementById('codeInput').value;
  let vulns = 0; scanResults = []; currentVulns = [];
  const patterns = [
    {name:'XSS Attack', regex:/innerHTML|document\.write/i, severity:'high'},
    {name:'SQL Injection', regex:/SELECT.*FROM|INSERT INTO/i, severity:'high'},
    {name:'Dangerous Functions', regex:/eval\s*\(|exec\(|system\(/i, severity:'high'},
    {name:'Cookie Access', regex:/document\.cookie/i, severity:'medium'},
    {name:'LocalStorage Risk', regex:/localStorage\.setItem/i, severity:'low'},
    {name:'Prototype Pollution', regex:/Object\.prototype/i, severity:'high'},
    {name:'Crypto Weakness', regex:/(MD5|SHA1|DES)/i, severity:'medium'},
    {name:'Weak Regex', regex:/\.match\s*\(/i, severity:'low'}
  ];
  
  patterns.forEach(p => {
    if (p.regex.test(code)) {
      vulns++; currentVulns.push(p);
      scanResults.push(`<div class="vuln-item severity-${p.severity}"><strong>ğŸš¨ ${p.name}</strong><br><small>Ø®Ø·ÙˆØ±Ø©: ${p.severity==='high'?'Ø¹Ø§Ù„ÙŠØ©':p.severity==='medium'?'Ù…ØªÙˆØ³Ø·Ø©':'Ù…Ù†Ø®ÙØ¶Ø©'}</small></div>`);
    }
  });
  
  if (!scanResults.length) scanResults = ['<div class="vuln-item severity-low"><strong>âœ… Ù…Ù…ØªØ§Ø²!</strong><br>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø«ØºØ±Ø§Øª Ø®Ø·ÙŠØ±Ø© ğŸ‰</div>'];
  
  document.getElementById('vulnCount').textContent = vulns;
  const level = vulns > 2 ? 'High' : vulns > 0 ? 'Medium' : 'Low';
  document.getElementById('secLevel').textContent = level;
  document.getElementById('secLevel').className = `stat ${level}`;
  document.getElementById('scanResult').innerHTML = scanResults.join('');
  document.getElementById('aiExplainBtn').style.display = 'block';
  
  scanHistoryArr.unshift(code.substring(0,80)+'...');
  if (scanHistoryArr.length > 3) scanHistoryArr.pop();
  document.getElementById('scanHistory').innerHTML = '<h4>ğŸ“‹ Ø¢Ø®Ø± 3 ÙØ­ÙˆØµØ§Øª:</h4>'+scanHistoryArr.map((s,i) => `<p>${i+1}: ${s}</p>`).join('');
}

function toggleAIExplain() {
  const el = document.getElementById('aiExplain');
  el.style.display = el.style.display === 'block' ? 'none' : 'block';
  if (el.style.display === 'block') generateAIExplanation();
}

function generateAIExplanation() {
  let html = `<h4>ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h4><p><strong>Ø§Ù„Ø«ØºØ±Ø§Øª: ${currentVulns.length}</strong></p>`;
  currentVulns.forEach(v => {
    let advice = v.severity === 'high' ? 'ğŸš¨ Ø§Ø³ØªØ®Ø¯Ù… textContent Ùˆ Prepared Statements' : 
                 v.severity === 'medium' ? 'âš ï¸ HttpOnly cookies' : 'âœ… Ù…Ù…ØªØ§Ø²';
    html += `<div class="vuln-item severity-${v.severity}"><strong>${v.name}</strong><br>${advice}</div>`;
  });
  document.getElementById('aiExplain').innerHTML = html;
}

function generateQuiz() {
  let html = '';
  questions.forEach((q,i) => {
    html += `<div class="quiz-q"><p style="font-weight:800;margin-bottom:25px;font-size:1.4em;">${q[0]}</p>`;
    if (q[3]) {
      html += `<label><input type="radio" name="q${i}" value="0"> Ù†Ø¹Ù…</label><label><input type="radio" name="q${i}" value="1"> Ù„Ø§</label>`;
    } else {
      q[1].forEach((opt,j) => html += `<label><input type="radio" name="q${i}" value="${j}"> ${opt}</label>`);
    }
    html += '</div>';
  });
  document.getElementById('quizBox').innerHTML = html;
}

document.getElementById('profileUpload').addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = evt => document.getElementById('profilePic').src = evt.target.result;
    reader.readAsDataURL(file);
  }
});

function logout() {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) { 
    localStorage.clear(); 
    location.reload(); 
  }
}

function toggleMode() {
  document.body.classList.toggle('light');
  localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
}

// Quiz Submit
document.getElementById('quizForm').addEventListener('submit', e => {
  e.preventDefault();
  let score = 0;
  questions.forEach((q,i) => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if (sel && parseInt(sel.value) === q[2]) score++;
  });
  
  lastScore = Math.round((score / questions.length) * 100);
  document.getElementById('resultScore').value = lastScore;
  
  const btn = document.getElementById('quizSubmitBtn');
  const text = document.getElementById('quizBtnText');
  const loading = document.getElementById('quizLoading');
  
  btn.disabled = true;
  text.style.display = 'none';
  loading.style.display = 'inline-block';
  
  setTimeout(() => {
    alert(`ğŸ‰ Ù†ØªÙŠØ¬ØªÙƒ: ${lastScore}%!\n${lastScore>=80?'ğŸ† Ù…Ù…ØªØ§Ø²!':lastScore>=60?'ğŸ”¥ Ø¬ÙŠØ¯!':'ğŸ“š Ø§Ø³ØªÙ…Ø±!'}`);
    
    document.getElementById('quizScore').textContent = `Ù†ØªÙŠØ¬ØªÙƒ: ${lastScore}%`;
    document.getElementById('quizBar').style.width = lastScore + '%';
    
    const level = lastScore>=80 ? 'Ù…ØªÙ‚Ø¯Ù…' : lastScore>=60 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ø¨ØªØ¯Ø¦';
    const badge = lastScore>=80 ? 'ğŸ† Ø®Ø¨ÙŠØ±' : lastScore>=60 ? 'ğŸ”¥ Ù…Ø­ØªØ±Ù' : 'ğŸŒ± Ù…Ø¨ØªØ¯Ø¦';
    
    document.getElementById('userLevel').textContent = level;
    document.getElementById('pLevel').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${level}`;
    document.getElementById('badge').textContent = badge;
    document.getElementById('profileBadge').textContent = badge;
    
    document.getElementById('quizResult').style.display = 'block';
    document.getElementById('quizResult').innerHTML = `<div style="text-align:center;padding:40px;background:rgba(0,0,0,0.5);border-radius:30px;"><h2 style="color:${lastScore>=70?'var(--green)':'var(--yellow)'}">${lastScore}%</h2><div class="progress" style="width:450px;margin:30px auto;"><div class="progress-fill" style="width:${lastScore}%"></div></div></div>`;
    
    // Ø¥Ø±Ø³Ø§Ù„ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
    const quizData = new FormData();
    quizData.append('name', user.name || 'Ù…Ø¬Ù‡ÙˆÙ„');
    quizData.append('email', user.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
    quizData.append('result_score', lastScore);
    quizData.append('form_type', 'quiz');
    quizData.append('_subject', 'Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± - CodeGuard AI');
    quizData.append('_captcha', 'false');
    
    fetch('https://formsubmit.co/shryfmhmdbdalghnyrajh@gmail.com', {
      method: 'POST',
      body: quizData
    });
    
    document.getElementById('quizThankYou').classList.remove('hidden');
    setTimeout(() => document.getElementById('quizThankYou').classList.add('hidden'), 4000);
    
    btn.disabled = false;
    text.style.display = 'inline-block';
    loading.style.display = 'none';
  }, 1500);
});

function playCourseVideo(src) { 
  document.getElementById('modalVideo').src = src; 
  document.getElementById('videoModal').style.display = 'flex'; 
}
function closeVideoModal(e) { 
  e.stopPropagation(); 
  document.getElementById('videoModal').style.display = 'none'; 
  document.getElementById('modalVideo').pause(); 
}
function playIntroVideo() { 
  document.getElementById('modalVideo').src = 'https://www.w3schools.com/html/mov_bbb.mp4'; 
  document.getElementById('videoModal').style.display = 'flex'; 
}

document.getElementById('videoModal').addEventListener('click', e => { 
  if (e.target === e.currentTarget) closeVideoModal(e); 
});

document.querySelectorAll('button,input,textarea').forEach(el => 
  el.addEventListener('focus', () => el.style.outline = '4px solid var(--blue)')
);
</script>
</body>
</html>
